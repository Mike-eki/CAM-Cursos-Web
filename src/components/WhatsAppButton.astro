---
import WhatsAppIcon from "../icons/WhatsAppIcon.astro";
import WhatsAppCountryOption from "./WhatsAppCountryOption.astro";
import ArgentinaFlagIcon from "../icons/ArgentinaFlagIcon.astro";
import ParaguayFlagIcon from "../icons/ParaguayFlagIcon.astro";

// Configuración de números de WhatsApp
const argentPhone = "5491123456789"; // Reemplaza con tu número de Argentina
const paraguayPhone = "595981234567";  // Reemplaza con tu número de Paraguay
---

<div class="whatsapp-container">
    <button class="whatsapp-button" id="whatsappBtn">
        <WhatsAppIcon color="#FFF"/>
    </button>
    
    <div class="country-options" id="countryOptions">
        <WhatsAppCountryOption 
            country="Argentina"
            phone={argentPhone}
            FlagIcon={ArgentinaFlagIcon}
        />
        <WhatsAppCountryOption 
            country="Paraguay"
            phone={paraguayPhone}
            FlagIcon={ParaguayFlagIcon}
        />
    </div>
</div>

<style>
    /* Container principal */
    .whatsapp-container {
        position: fixed;
        bottom: 30px;
        right: 30px;
        z-index: 99999900;
    }

    /* Botón de WhatsApp flotante */
    .whatsapp-button {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 20px rgba(37, 211, 102, 0.4);
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        position: relative;
    }

    .whatsapp-button:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 30px rgba(37, 211, 102, 0.6);
    }

    .whatsapp-button:active {
        transform: scale(0.95);
    }

    .whatsapp-button svg {
        width: 35px;
        height: 35px;
        fill: white;
    }

    /* Opciones de país */
    .country-options {
        position: absolute;
        bottom: 75px;
        right: 0;
        display: flex;
        flex-direction: column;
        gap: 10px;
        opacity: 0;
        visibility: hidden;
        transform: translateY(10px);
        transition: all 0.3s ease;
        pointer-events: none;
    }

    .country-options.active {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
        pointer-events: all;
    }

    /* Animación de pulso */
    @keyframes pulse {
        0% {
            box-shadow: 0 4px 20px rgba(37, 211, 102, 0.4);
        }
        50% {
            box-shadow: 0 4px 30px rgba(37, 211, 102, 0.7);
        }
        100% {
            box-shadow: 0 4px 20px rgba(37, 211, 102, 0.4);
        }
    }

    .whatsapp-button {
        animation: pulse 2s infinite;
    }

    /* Pausar animación cuando el menú está activo */
    .whatsapp-container:has(.country-options.active) .whatsapp-button {
        animation: none;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .whatsapp-container {
            bottom: 20px;
            right: 20px;
        }

        .whatsapp-button {
            width: 55px;
            height: 55px;
        }

        .whatsapp-button svg {
            width: 30px;
            height: 30px;
        }

        .country-options {
            bottom: 70px;
        }
    }
</style>

<script>
    const btn = document.getElementById('whatsappBtn');
    const options = document.getElementById('countryOptions');
    let isOpen = false;

    // Toggle del menú al hacer clic
    btn?.addEventListener('click', (e) => {
        e.stopPropagation();
        isOpen = !isOpen;
        options?.classList.toggle('active', isOpen);
    });

    // Cerrar al hacer clic fuera
    document.addEventListener('click', (e) => {
        const target = e.target as HTMLElement;
        const container = document.querySelector('.whatsapp-container');
        if (!container?.contains(target)) {
            isOpen = false;
            options?.classList.remove('active');
        }
    });

    // Cerrar al hacer clic en una opción
    options?.querySelectorAll('.country-option').forEach(option => {
        option.addEventListener('click', () => {
            isOpen = false;
            options?.classList.remove('active');
        });
    });
</script>